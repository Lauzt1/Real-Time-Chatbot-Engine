version: "3.1"
rules:

- rule: Greet
  steps:
    - intent: greet
    - action: utter_greet

- rule: Goodbye
  steps:
    - intent: goodbye
    - action: utter_goodbye

- rule: Handle low-confidence inputs
  steps:
  - intent: nlu_fallback
  - action: utter_fallback
  - action: action_listen

- rule: Handle product info requests
  steps:
  - intent: ask_product_info
  - action: action_product_info
  - action: action_listen

- rule: respond with product info
  steps:
  - intent: ask_product_info
  - action: action_product_info

- rule: Quote request
  steps:
    - intent: ask_quote
    - action: utter_ask_quote

- rule: Human handoff
  steps:
    - intent: agent_fallback
    - action: utter_agent_fallback

# -------------------------------------------------
#  Homepage query â€“ no product context yet
# -------------------------------------------------
- rule: Handle product info requests
  steps:
    - intent: ask_product_info
    - action: action_product_info
    - action: action_listen
    
# -------------------------
# Page-context awareness
# -------------------------
- rule: Set product context from page URL
  steps:
    - slot_was_set:
        - page
    - action: action_set_product_context

# -------------------------
# Dynamic attribute queries on product pages
# -------------------------
- rule: Answer description on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_description
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer weight on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_weight
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer power on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_power
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer orbit on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_orbit
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer backing pad on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_backingpad
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer size on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_size
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer code on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_code
    - action: action_query_product_attribute
    - action: action_listen

- rule: Answer colour on product page
  condition:
    - slot_was_set:
        - product_id
  steps:
    - intent: ask_colour
    - action: action_query_product_attribute
    - action: action_listen

# -------------------------
# Fallback/no-op for unexpected page-context events
# -------------------------
- rule: ignore empty page-context call
  steps:
    - action: action_noop